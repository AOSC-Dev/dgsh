<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<title>dgsh &mdash; directed graph shell</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Bootstrap -->
<link href="../../a/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
<link href="../../a/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" />
<link href="../../a/prettify/prettify.css" type="text/css" rel="stylesheet" />
<link href="../../a/dds-bstyle.css" rel="stylesheet" />
</head>
<body data-spy="scroll" data-target="#sidemenu">

<div class="top">dgsh dds</div>
<div class="row">
    <div class="span4" id="sidemenu" >
    <ul class="nav nav-list sidenav" data-spy="affix">
    <li ><a href="#intro">Introduction</a></li>
	<li>
	<ul class="nav nav-list">
	<li ><a href="#ipc">IPC</a></li>
	<li ><a href="#syntax">Syntax</a></li>
	</ul>
	</li>
    <li ><a href="#download">Downloading and installation</a></li>
    <li ><a href="#reference">Reference</a></li>
    <li><a href="#examples">Examples</a></li>
	<li>
	<ul class="nav nav-list">
<!-- #!sh format-eg.sh -c -->
	</ul>
	</li>
    </ul>
    </div> <!-- span4 -->
    <div class="span8">

<!-- About {{{1
================================================== -->
<section id="intro">
  <div class="page-header">
    <h1>dgsh &mdash; directed graph shell</h1>
  </div>
<p>
The directed graph gather shell, <em>dgsh</em>,
provides an expressive way to construct
sophisticated and efficient big data set and stream processing pipelines
using existing Unix tools as well as custom-built components.
It is a Unix-style shell allowing the specification of pipelines
with non-linear non-uniform operations.
These form a directed acyclic process graph,
which is typically executed by multiple processor cores,
thus increasing the operation's processing throughput.
</p>
<p>
If you want to get a feeling on how <em>dgsh</em> works in practice,
skip right down to the <a href="#examples">examples</a> section.
</p>
</section> <!-- Introduction -->

<section id="ipc"> <!-- {{{2 -->
<h2>Inter-process communication</h2>
<p>
<em>Dgsh</em> provides two new ways
for expressing inter-process communication.

</p>
<dl class="dl-horizontal">
<dt>Multipipe blocks {{ ... }}</dt><dd>
send the input received on its input channel to the processes
that reside within the block and/or pass the output produced by the processes
within the block through its output channel.
Multipipe blocks are made possible by a helper program,
the dgsh <dt>concentrator</dt>, which connects and coordinates
message block communication between the connected processes.
Each concentrator command is created
and executed dynamically by <dt>bash</dt> with arguments
the number of processes the block contains and its type, that is input or
output.
Then <dt>bash</dt> also takes care to setup the connections
between the concentrator, the IO connection(s) piped to it, and
the processes contained in the block.

<dt>Stored values</dt> offer a convenient way for communicating
computed values between arbitrary processes on the graph.
They allow the storage of a data stream's
last record into a named buffer.
This record can be later retrieved asynchronously by one or more readers.
Data in a stored value can be piped into a process or out of it, or it can be read
using the shell's command output substitution syntax.
Stored values are implemented internally through Unix-domain sockets,
a background-running store program, <em>dgsh-writeval</em>, and
a reader program, <em>dgsh-readval</em>.
The behavior of a stored value's IO can be modified by adding flags to
<em>dgsh-writeval</em> and <em>dgsh-readval</em>.
</dd>
</dl>
</section>

<section id="syntax"> <!-- {{{2 -->
<h2>Syntax</h2>
<p>
A <em>dgsh</em> script follows the syntax of a <em>bash</em>(1) shell
script with the addition of <em>multipipe</em> blocks.
A multipipe block contains one or more <em>dgsh</em> commands,
which are executed asynchronously (in parallel, in the background).
Data may be redirected or piped into and out of a multipipe block.
With multipipe blocks <em>dgsh</em> scripts form directed acyclic process graphs.
Multipipe blocks can be recursively composed.

<p>
In the following example the output of <em>ls</em> is distributed to
six commands:
<em>awk</em>, which sums the number of bytes and passes the
result to the <em>tr</em> command that deletes
newline characters,
<em>wc</em>, which counts the number of files,
<em>awk</em>, which counts the number of bytes,
<em>grep</em>, which counts the number of directories and passes the
result to the <em>tr</em> command that deletes newline characters,
three <code>echo</code> commands, which provide the headers
of the data output by the commands described above.
All six commands pass their output
to the <code>cat</code> command, which gathers their outputs
in order.
</p>

<pre class="prettyprint lang-bash">
FREE=`df -h . | awk '!/Use%/{print $4}'`

ls -n |
tee |
{{
        # Reorder fields in DIR-like way
        awk '!/^total/ {print $6, $7, $8, $1, sprintf("%8d", $5), $9}' &

        # Count number of files
        wc -l | tr -d \\n &

        # Print label for number of files
        echo -n ' File(s) ' &

        # Tally number of bytes
        awk '{s += $5} END {printf("%d bytes\n", s)}' &

        # Count number of directories
        grep -c '^d' | tr -d \\n &

        # Print label for number of dirs and calculate free bytes
        echo " Dir(s) $FREE bytes free" &
}} |
cat
</pre>

<p>
<em>Dgsh</em> extends the syntax of the Unix Bourne-shell and
its descendants, such as <em>bash</em>.
The extensions involve
inter-process communication mechanisms through a syntax
that allows the specification
of pipelines communicating in a directed acyclic process graph.
This pattern can perform non-uniform non-linear processing.
<em>Dgsh</em> is set to operate with the Bash shell
when provided with the <em>--dgsh</em> argument.

A dag is understood as a recursive composition of boxes $b$ with <rm>In</rm>(b)
ordered inputs and <rm>Out</rm>(b) ordered outputs.
A box's number of inputs or outputs may be designated ``flexible'',
which can take values $[1, \infty]$.

A composition step (symbolized by <tt>|</tt>) matches in order the outputs
L of one box b_1 to the inputs R of another b_2.
A pairwise composition may involve at most one box with flexible input and
one box with flexible output.
In this case flexible inputs or outputs may expand to cover the other box's
cardinality of outputs or inputs, with the cardinality of a flexible element
on the other side counting as one.
The cardinalities of L and R must be equal, either directly or by
expanding through flexibility.

Boxes can be recursively grouped by bracketing an ordered set of
asynchronously running boxes using a pair of double curly braces
(<tt>{{ }}</tt>).
The inputs and outputs of the group are those of the grouped boxes,
ordered according to the order of the boxes in the group.
At most one box in a group may have flexible input or output;
the corresponding flexibility is inherited by the group.
</p>

<pre class="prettyprint">
<!-- #!sh format-syntax.sh -->
</pre>
</section> <!-- syntax -->

<!-- Downloading and installation {{{1
================================================== -->
<section id="download">
  <div class="page-header">
    <h1>Downloading and installation</h1>
  </div>
<p>
You can clone the project's source code through its
<a href="https://github.com/dspinellis/dgsh">GitHub page</a>.
Alternatively, you can download the latest version of the source code
as a zip file through
<a href="https://github.com/dspinellis/dgsh/archive/master.zip">this link</a>.
</p>
<p>
To compile and run <em>dgsh</em> you will need to have
a C compiler, GNU make, and <a href="http://www.perl.org/">Perl</a>
installed in your system.
The optional Perl module <em>Graph</em> is used to detect cycles that
can lead to deadlocks.
An installation of <a href="http://www.graphviz.org/">GraphViz</a>
will allow you to visualize the <em>dgsh</em> graphs that you specify
in your programs.
The <em>dgsh</em> suite has been tested under
Cygwin, Debian Linux, FreeBSD, and Mac OS X.
</p>
<p>
To install the <em>dgsh</em> suite run <code>make</code>,
followed by <code>sudo make install</code>.
By default, the program and its documentation are installed under
<code>/usr/local</code>.
You can modify this by setting the <code>INSTPREFIX</code> variable
during installation,
e.g. <code>sudo make INSTPREFIX=/usr install</code>.
Alternatively, you can also run <em>dgsh</em> from its current
directory, by running <code>make</code> and then using the <code>-p</code>
flag to specify the location of the helper programs,
as in
<code>./dgsh -p . example/compress-compare.sh http://www.google.com</code>.
</p>
</section>

<!-- Reference {{{1
================================================== -->
<section id="reference">
  <div class="page-header">
    <h1>Reference documentation</h1>
  </div>
<p>
These are the manual pages for <em>dgsh</em> and the associated helper programs
in formats suitable for browsing and printing.
</p>
<dl >
<dt> dgsh </dt><dd> scatter gather shell <a href="dgsh.html">HTML</a>, <a href="dgsh.pdf">PDF</a></dd>
<dt> dgsh-tee </dt><dd> buffer and copy or scatter standard input to one or more sinks <a href="dgsh-tee.html">HTML</a>, <a href="dgsh-tee.pdf">PDF</a></dd>
<dt> dgsh-writeval </dt><dd> write values to a data store <a href="dgsh-writeval.html">HTML</a>, <a href="dgsh-writeval.pdf">PDF</a></dd>
<dt> dgsh-readval </dt><dd> data store client <a href="dgsh-readval.html">HTML</a>, <a href="dgsh-readval.pdf">PDF</a></dd>
</dl>
</section>



<!-- Examples {{{1
================================================== -->
<section id="examples">
  <div class="page-header">
    <h1>Examples</h1>
  </div>

<!-- #!sh format-eg.sh -->

</section> <!-- Examples -->

</div> <!-- span8 -->
</div> <!-- row -->

<!-- Bootstrap -->
<script src="http://code.jquery.com/jquery.js"></script>
<script src="../../a/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../a/prettify/prettify.js"></script>

<script>
    $(document).ready(function() {
	prettyPrint();
    });
</script>

<div class="license">
<!--Creative Commons License--><a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/gr/deed.en">
<img alt="Creative Commons License" src="http://creativecommons.org/images/public/somerights20.png"/></a>
Unless otherwise expressly stated, all original material on this page
created by Diomidis Spinellis is licensed under a
<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/gr/deed.en">Creative Commons Attribution-Share Alike 3.0 Greece License</a>.
</div>

</body>
</html>
