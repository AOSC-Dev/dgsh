#!/bin/sh
# Automatically generated file
# Source file example/parallel-logresolve.sh

export SGDIR=/tmp/sg-$$

rm -rf $SGDIR

trap '
# Stop key-value stores

# Kill processes we have launched in the background
kill $SGPID 2>/dev/null

# Remove temporary directory
rm -rf "$SGDIR"' 0

trap 'exit $?' 1 2 3 15

mkdir $SGDIR

mkfifo  \
$SGDIR/npi-0.0.0 \
$SGDIR/npfo-resolved.0 \
$SGDIR/npi-0.0.1 \
$SGDIR/npfo-resolved.1 \
$SGDIR/npi-0.0.2 \
$SGDIR/npfo-resolved.2 \
$SGDIR/npi-0.0.3 \
$SGDIR/npfo-resolved.3 \
$SGDIR/npi-0.0.4 \
$SGDIR/npfo-resolved.4 \
$SGDIR/npi-0.0.5 \
$SGDIR/npfo-resolved.5 \
$SGDIR/npi-0.0.6 \
$SGDIR/npfo-resolved.6 \
$SGDIR/npi-0.0.7 \
$SGDIR/npfo-resolved.7 \
$SGDIR/npi-0.0.8 \
$SGDIR/npfo-resolved.8 \
$SGDIR/npi-0.0.9 \
$SGDIR/npfo-resolved.9 \
$SGDIR/npi-0.0.10 \
$SGDIR/npfo-resolved.10 \
$SGDIR/npi-0.0.11 \
$SGDIR/npfo-resolved.11 \
$SGDIR/npi-0.0.12 \
$SGDIR/npfo-resolved.12 \
$SGDIR/npi-0.0.13 \
$SGDIR/npfo-resolved.13 \
$SGDIR/npi-0.0.14 \
$SGDIR/npfo-resolved.14 \
$SGDIR/npi-0.0.15 \
$SGDIR/npfo-resolved.15 \
$SGDIR/npi-0.0.16 \
$SGDIR/npfo-resolved.16 \
$SGDIR/npi-0.0.17 \
$SGDIR/npfo-resolved.17 \
$SGDIR/npi-0.0.18 \
$SGDIR/npfo-resolved.18 \
$SGDIR/npi-0.0.19 \
$SGDIR/npfo-resolved.19

#!/usr/local/bin/sgsh
#
# Resolve IP addresses of web logs in parallel
# Demonstrates parallel execution
#
#  Copyright 2013 Diomidis Spinellis
#
#  Licensed under the Apache License, Version 2.0 (the "License");
#  you may not use this file except in compliance with the License.
#  You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
#  Unless required by applicable law or agreed to in writing, software
#  distributed under the License is distributed on an "AS IS" BASIS,
#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#  See the License for the specific language governing permissions and
#  limitations under the License.
#

# Add record number as the second field
awk '{$2 = ++n " " $2; print}' "$*" |

# Two parallel line scatter invocations
sgsh-tee  -s $SGDIR/npi-0.0.0 $SGDIR/npi-0.0.1 $SGDIR/npi-0.0.2 $SGDIR/npi-0.0.3 $SGDIR/npi-0.0.4 $SGDIR/npi-0.0.5 $SGDIR/npi-0.0.6 $SGDIR/npi-0.0.7 $SGDIR/npi-0.0.8 $SGDIR/npi-0.0.9 $SGDIR/npi-0.0.10 $SGDIR/npi-0.0.11 $SGDIR/npi-0.0.12 $SGDIR/npi-0.0.13 $SGDIR/npi-0.0.14 $SGDIR/npi-0.0.15 $SGDIR/npi-0.0.16 $SGDIR/npi-0.0.17 $SGDIR/npi-0.0.18 $SGDIR/npi-0.0.19 & SGPID="$! $SGPID"
 <$SGDIR/npi-0.0.0 /usr/local/sbin/logresolve | ./teebuff -i >$SGDIR/npfo-resolved.0 & SGPID="$! $SGPID"
 <$SGDIR/npi-0.0.1 /usr/local/sbin/logresolve | ./teebuff -i >$SGDIR/npfo-resolved.1 & SGPID="$! $SGPID"
 <$SGDIR/npi-0.0.2 /usr/local/sbin/logresolve | ./teebuff -i >$SGDIR/npfo-resolved.2 & SGPID="$! $SGPID"
 <$SGDIR/npi-0.0.3 /usr/local/sbin/logresolve | ./teebuff -i >$SGDIR/npfo-resolved.3 & SGPID="$! $SGPID"
 <$SGDIR/npi-0.0.4 /usr/local/sbin/logresolve | ./teebuff -i >$SGDIR/npfo-resolved.4 & SGPID="$! $SGPID"
 <$SGDIR/npi-0.0.5 /usr/local/sbin/logresolve | ./teebuff -i >$SGDIR/npfo-resolved.5 & SGPID="$! $SGPID"
 <$SGDIR/npi-0.0.6 /usr/local/sbin/logresolve | ./teebuff -i >$SGDIR/npfo-resolved.6 & SGPID="$! $SGPID"
 <$SGDIR/npi-0.0.7 /usr/local/sbin/logresolve | ./teebuff -i >$SGDIR/npfo-resolved.7 & SGPID="$! $SGPID"
 <$SGDIR/npi-0.0.8 /usr/local/sbin/logresolve | ./teebuff -i >$SGDIR/npfo-resolved.8 & SGPID="$! $SGPID"
 <$SGDIR/npi-0.0.9 /usr/local/sbin/logresolve | ./teebuff -i >$SGDIR/npfo-resolved.9 & SGPID="$! $SGPID"
 <$SGDIR/npi-0.0.10 /usr/local/sbin/logresolve | ./teebuff -i >$SGDIR/npfo-resolved.10 & SGPID="$! $SGPID"
 <$SGDIR/npi-0.0.11 /usr/local/sbin/logresolve | ./teebuff -i >$SGDIR/npfo-resolved.11 & SGPID="$! $SGPID"
 <$SGDIR/npi-0.0.12 /usr/local/sbin/logresolve | ./teebuff -i >$SGDIR/npfo-resolved.12 & SGPID="$! $SGPID"
 <$SGDIR/npi-0.0.13 /usr/local/sbin/logresolve | ./teebuff -i >$SGDIR/npfo-resolved.13 & SGPID="$! $SGPID"
 <$SGDIR/npi-0.0.14 /usr/local/sbin/logresolve | ./teebuff -i >$SGDIR/npfo-resolved.14 & SGPID="$! $SGPID"
 <$SGDIR/npi-0.0.15 /usr/local/sbin/logresolve | ./teebuff -i >$SGDIR/npfo-resolved.15 & SGPID="$! $SGPID"
 <$SGDIR/npi-0.0.16 /usr/local/sbin/logresolve | ./teebuff -i >$SGDIR/npfo-resolved.16 & SGPID="$! $SGPID"
 <$SGDIR/npi-0.0.17 /usr/local/sbin/logresolve | ./teebuff -i >$SGDIR/npfo-resolved.17 & SGPID="$! $SGPID"
 <$SGDIR/npi-0.0.18 /usr/local/sbin/logresolve | ./teebuff -i >$SGDIR/npfo-resolved.18 & SGPID="$! $SGPID"
 <$SGDIR/npi-0.0.19 /usr/local/sbin/logresolve | ./teebuff -i >$SGDIR/npfo-resolved.19 & SGPID="$! $SGPID"
# Gather the results
	# Merge the files on the second numerical field
	sort -m -k2n $SGDIR/npfo-resolved.0 $SGDIR/npfo-resolved.1 $SGDIR/npfo-resolved.2 $SGDIR/npfo-resolved.3 $SGDIR/npfo-resolved.4 $SGDIR/npfo-resolved.5 $SGDIR/npfo-resolved.6 $SGDIR/npfo-resolved.7 $SGDIR/npfo-resolved.8 $SGDIR/npfo-resolved.9 $SGDIR/npfo-resolved.10 $SGDIR/npfo-resolved.11 $SGDIR/npfo-resolved.12 $SGDIR/npfo-resolved.13 $SGDIR/npfo-resolved.14 $SGDIR/npfo-resolved.15 $SGDIR/npfo-resolved.16 $SGDIR/npfo-resolved.17 $SGDIR/npfo-resolved.18 $SGDIR/npfo-resolved.19 |

	# Remove second field
	cut -d ' ' -f 1,3-

